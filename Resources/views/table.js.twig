var {{ table.name }}_table = $('#{{ table.name }}').DataTable({
    'ajax': '{{ path }}',
    'serverSide': true,
    'order': [
        {% set first = true %}
        {%- for column in table.columns %}
        {% if column.options.order is not null %}
            {% if not first %} ,{% endif %}[{{ loop.index0 }}, '{{ column.options.order }}']
            {% set first = false %}
        {% endif %}
        {% endfor -%}
    ],
    'columns': [{% for column in table.columns %}

        {
            'data': '{{ column.name }}',
            'name': '{{ column.name }}',
            'orderable': {% if column.options.sortable %}true{% else %}false{% endif %},
            'searchable': {% if column.options.searchable %}true{% else %}false{% endif %}

        }
        {%- if not loop.last %},
        {% endif %}
        {% endfor %}

    ],

    'stateSave': true,
    'stateLoaded': function (settings, data) {
        $(data.columns).each(function(index, item) {
            var value = item.search.search;
            if (0 === value.length) {
                return true;
            }

            var $input = $('#{{ table.name }}_' + settings.aoColumns[index].name + '_filter');
            var $inputEmpty = $('#{{ table.name }}_' + settings.aoColumns[index].name + '_filter_empty');
            if (0 < $inputEmpty.length) {
                if ('|empty=true' == value.substring(value.length - 11)) {
                    $inputEmpty.prop('checked', true);
                    value = value.substring(0, value.length - 11);
                } else if ('|empty=false' == value.substring(value.length - 12)) {
                    $inputEmpty.prop('checked', false);
                    value = value.substring(0, value.length - 12);
                }
            }

            if (1 === $input.length) {
                $input.val(value);
            }
        });
    }
});

{% for column in table.columns %}

    {% if column.options.filter_empty %}
    var {{ table.name }}_{{ column.name }}_filter_empty = $('#{{ table.name }}_{{ column.name }}_filter_empty').is(':checked')

    $('#{{ table.name }}_{{ column.name }}_filter_empty').on('change', function() {
        {{ table.name }}_{{ column.name }}_filter_empty = $(this).is(':checked');

        {% if column.options.filter == false %}
        var value = '|empty=' + {{ table.name }}_{{ column.name }}_filter_empty.toString();
        {{ table.name }}_table.column({{ loop.index0 }})
                .search(value)
                .draw();
        {% else %}
        $('#{{ table.name }}_{{ column.name }}_filter').trigger('change');
        {% endif %}
    });
    {% endif %}


    {% if column.options.filter == 'text' %}
    var throttle = null;
    $('#{{ table.name }}_{{ column.name }}_filter').on('keyup change', function() {
        if (throttle != null) {
            window.clearTimeout(throttle);
            throttle = null;
        }

        var value = $(this).val();
        {% if column.options.filter_empty %}
        value += '|empty=' + {{ table.name }}_{{ column.name }}_filter_empty.toString();
        {% endif %}
        if ({{ table.name }}_table.column({{ loop.index0 }}).search() !== value) {
            throttle = window.setTimeout(function() {
                {{ table.name }}_table.column({{ loop.index0 }})
                    .search(value)
                    .draw();
            }, 200);
        }
    });
    {% elseif column.options.filter == 'select' %}
    $('#{{ table.name }}_{{ column.name }}_filter').on('change', function() {
        var value = $(this).val();
        {% if column.options.filter_empty %}
        value += '|empty=' + {{ table.name }}_{{ column.name }}_filter_empty.toString();
        {% endif %}
        {{ table.name }}_table.column({{ loop.index0 }})
            .search(value)
            .draw();
    });
    {% endif %}


{% endfor %}
